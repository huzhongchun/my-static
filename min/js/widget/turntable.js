!function(){var t=function(t,e){this.settings=$.extend({img:"",arrowImg:"",arrowWidth:0,arrowHeight:0,arrowTop:86.25,width:280,areaNum:8,random:!0,randomChance:{4:80,5:20},prizeArea:{1:{area:[1,3],message:"满100减10现金券"},2:{area:[2,5],message:"满300减40现金券"},3:{area:[4,7],message:"满500减70现金券"},4:{area:[6],message:"谢谢参与"},5:{area:[8],message:"iPhone 7 一台"}},success:function(){alert("已完成")}},e),this.element=document.getElementById(t),this.init()};t.prototype={constructor:t,rotate:0,sign:0,prizeMessage:"",init:function(){this.template='<div class="turntable-area" style="position:relative;margin:0px auto;"><img class="turntable-arrow turntable-btn" style="position: absolute;z-index: 2;" src="<%=arrowImg%>"><img class="turntable-img" src="<%=img%>"/></div>';var t=this.settings,e=this.parseTpl(this.template,t);$(this.element).append(e),$(".turntable-arrow").css({width:t.arrowWidth/2,top:t.arrowTop,left:(t.width-t.arrowWidth/2)/2}),$(".turntable-img").css("width",t.width),this.initEvent()},parseTpl:function(t,e){var r="var __p=[];with(obj||{}){__p.push('"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(t,e){return"',"+e.replace(/\\'/,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(t,e){return"');"+e.replace(/\\'/,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+'\');}return __p.join("");',a=new Function("obj",r);return e?a(e):a},getRand:function(t){var e="",r=0;for(var a in t)r+=t[a];for(var n in t){var s=Math.random()*r;if(s<=t[n]){e=n;break}r-=t[n]}return e},initEvent:function(){var t=this,e=t.settings;e.random&&$(".turntable-btn").on("tap",function(){var r=t.getRand(e.randomChance);t.startRotate(r)}),$(".turntable-img").off("webkitTransitionEnd"),$(".turntable-img").on("webkitTransitionEnd",function(){$(".turntable-btn").css("pointer-events","all"),this.style.webkitTransition="-webkit-transform 0ms ease-in-out",this.style.webkitTransform="rotateZ("+t.rotate+"deg)";try{e.success.apply(t,t.args)}catch(r){e.success.apply(t,[t.sign,"没有中奖信息"])}})},startRotate:function(t){var e=this.settings,r=this;r.sign=t,r.args=[].slice.call(arguments);var a,n=e.prizeArea[t].area;a=n.length>1?n[Math.floor(Math.random()*n.length)]:n[0];var s=360/e.areaNum,i=s*Math.random();10>=i?i+=10:10>=s-i&&(i-=10);var o=r.rotate=Math.floor((a-1)*s+i),l=$(".turntable-img"),c=$(".turntable-btn");"none"!=c.css("pointer-events")&&(l.css("pointer-events","none"),c.css("pointer-events","none"),l[0].style.webkitTransition="-webkit-transform 6s ease-in-out",l[0].style.webkitTransform="rotateZ("+(3240+o)+"deg)")}},F.addWidget("turnTableObject",t)}(window);