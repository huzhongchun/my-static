!function(t){var e=function(t){var e=function(){};this.settings=$.extend({id:"scroll-box",pullDownCallback:e,pullUpCallback:e,startPullDownCallback:e,startPullDownMaxLength:40},t),this.init()};e.prototype={constructor:e,init:function(){var t=this,e=this.settings;if(t.time={},t.pageXY={},t.speed=0,t.direction=null,t.parentHeight=0,!e.id||!$("#"+e.id))return console.log("id或dom为null!"),!1;t.dom=$("#"+e.id).css({position:"absolute",top:"0",left:"0"});var n=$(this.dom).parent();n.css({overflow:"hidden",position:"relative"}),t.addListener()},addListener:function(){var t=this,e=this.settings,n=t.pageXY;t.touchendFlag=!0;var o=$(t.dom);o.on("touchstart",function(e){t.time.startT=(new Date).getTime(),n.startX=e.touches[0].pageX,n.startY=e.touches[0].pageY;var o=t.getTranslateArray();n.currentX=parseInt(o[0]),n.currentY=parseInt(o[1]),t.stopMoveByCss(n.currentY),t.maxMove=t.getMaxMove()}),o.on("touchmove",function(s){s.preventDefault(),n.endX=s.touches[0].pageX,n.endY=s.touches[0].pageY,n.moveX=n.endX-n.startX,n.movedY=n.endY-n.startY,t.direction=n.movedY>0?"up":"down",n.targetX=n.currentX+n.movedX,n.targetY=n.currentY+n.movedY,n.currentY<="0"&&n.targetY>0&&t.touchendFlag&&(e.startPullDownCallback(),t.touchendFlag=!1),n.currentY<=e.startPullDownMaxLength&&n.targetY>e.startPullDownMaxLength&&t.maxMove>0?o.css("top","40px"):t.maxMove>0&&(n.targetY<-(t.maxMove+e.startPullDownMaxLength)?o.css("top",-(e.startPullDownMaxLength+t.maxMove)+"px"):o.css("top",n.targetY+"px"))}),o.on("touchend",function(){var o,s,a;t.touchendFlag=!0;var r=t.getTranslateArray();n.touchEndX=parseInt(r[0]),n.touchEndY=parseInt(r[1]),t.time.endT=(new Date).getTime(),t.time.moveingT=t.time.endT-t.time.startT,n.moveLen=n.touchEndY-n.currentY,t.speed=Math.abs(n.moveLen/t.time.moveingT),o=t.time.moveingT/200,s=500*t.speed,a="down"===t.direction?n.touchEndY-s:n.touchEndY+s,a>=e.startPullDownMaxLength&&(a=e.startPullDownMaxLength),a<-(t.maxMove+e.startPullDownMaxLength)&&(a=-(t.maxMove+e.startPullDownMaxLength)),t.moveByCss(o,a),t.monitor()})},getTranslateArray:function(){var e,n=$(this.dom),o=parseInt(t.getComputedStyle(n[0]).top);return e="none"===o[0]?["0","0","0"]:["0",o,"0"]},stopMoveByCss:function(t){var e=$(this.dom);e.css({"-webkit-transition":"top 0s ease-out 0s",transition:"top 0s ease-out 0s"}),e.css("top",t+"px")},moveByCss:function(t,e){var n=(this.settings,$(this.dom));n.css({"-webkit-transition":"top "+t+"s cubic-bezier(0.333333,0.666667,0.66667,1) 0s",transition:"top "+t+"s cubic-bezier(0.333333,0.666667,0.66667,1) 0s"}),n.css("top",e+"px")},offset:function(t){for(var e=0,n=0,o=t;o.offsetParent;)e+=o.offsetLeft,n+=o.offsetTop,o=o.offsetParent;return{left:e,top:n}},getMaxMove:function(){var t=this.settings,e=$("#"+t.id).height(),n=e-$(this.dom).parent().height();return 0>n&&(n=0),n},monitor:function(){var e,n=this,o=this.settings,s=$(this.dom);!function(t){var e=function(t){var e=function(){};this.settings=$.extend({id:"scroll-box",pullDownCallback:e,pullUpCallback:e,startPullDownCallback:e,startPullDownMaxLength:40},t),this.init()};e.prototype={constructor:e,init:function(){var t=this,e=this.settings;if(t.time={},t.pageXY={},t.speed=0,t.direction=null,t.parentHeight=0,!e.id||!$("#"+e.id))return console.log("id或dom为null!"),!1;t.dom=$("#"+e.id);var n=$(this.dom).parent();n.css("overflow","hidden"),t.addListener()},addListener:function(){var t=this,e=this.settings,n=t.pageXY;t.touchendFlag=!0;var o=$(t.dom);o.on("touchstart",function(e){t.time.startT=(new Date).getTime(),n.startX=e.touches[0].pageX,n.startY=e.touches[0].pageY;var o=t.getTranslateArray();n.currentX=parseInt(o[0]),n.currentY=parseInt(o[1]),t.stopMoveByCss(n.currentY),t.maxMove=t.getMaxMove()}),o.on("touchmove",function(s){s.preventDefault(),n.endX=s.touches[0].pageX,n.endY=s.touches[0].pageY,n.moveX=n.endX-n.startX,n.movedY=n.endY-n.startY,t.direction=n.movedY>0?"up":"down",n.targetX=n.currentX+n.movedX,n.targetY=n.currentY+n.movedY,n.currentY<="0"&&n.targetY>0&&t.touchendFlag&&(e.startPullDownCallback(),t.touchendFlag=!1),n.currentY<=e.startPullDownMaxLength&&n.targetY>e.startPullDownMaxLength&&t.maxMove>0?o.css("top","40px"):t.maxMove>0&&(n.targetY<-(t.maxMove+e.startPullDownMaxLength)?o.css("top",-(e.startPullDownMaxLength+t.maxMove)+"px"):o.css("top",n.targetY+"px"))}),o.on("touchend",function(){var o,s,a;t.touchendFlag=!0;var r=t.getTranslateArray();n.touchEndX=parseInt(r[0]),n.touchEndY=parseInt(r[1]),t.time.endT=(new Date).getTime(),t.time.moveingT=t.time.endT-t.time.startT,n.moveLen=n.touchEndY-n.currentY,t.speed=Math.abs(n.moveLen/t.time.moveingT),o=t.time.moveingT/200,s=500*t.speed,a="down"===t.direction?n.touchEndY-s:n.touchEndY+s,a>=e.startPullDownMaxLength&&(a=e.startPullDownMaxLength),a<-(t.maxMove+e.startPullDownMaxLength)&&(a=-(t.maxMove+e.startPullDownMaxLength)),t.moveByCss(o,a),t.monitor()})},getTranslateArray:function(){var e,n=$(this.dom),o=parseInt(t.getComputedStyle(n[0]).top);return e="none"===o[0]?["0","0","0"]:["0",o,"0"]},stopMoveByCss:function(t){var e=$(this.dom);e.css({"-webkit-transition":"top 0s ease-out 0s",transition:"top 0s ease-out 0s"}),e.css("top",t+"px")},moveByCss:function(t,e){var n=(this.settings,$(this.dom));n.css({"-webkit-transition":"top "+t+"s cubic-bezier(0.333333,0.666667,0.66667,1) 0s",transition:"top "+t+"s cubic-bezier(0.333333,0.666667,0.66667,1) 0s"}),n.css("top",e+"px")},offset:function(t){for(var e=0,n=0,o=t;o.offsetParent;)e+=o.offsetLeft,n+=o.offsetTop,o=o.offsetParent;return{left:e,top:n}},getMaxMove:function(){var t=this.settings,e=$("#"+t.id).height(),n=e-$(this.dom).parent().height();return 0>n&&(n=0),n},monitor:function(){var t,e=this,n=this.settings,o=$(this.dom),s=setInterval(function(){var a=e.getTranslateArray(),r=parseInt(a[1]);r>0&&(e.stopMoveByCss(r),e.moveByCss("0.5",0),t=function(){n.pullDownCallback(),o.off("webkitTransitionEnd")},t(),clearInterval(s)),r<-e.maxMove&&(e.stopMoveByCss(r),e.moveByCss("0.5",-e.maxMove),t=function(){n.pullUpCallback(),o.off("webkitTransitionEnd")},t(),clearInterval(s))},100)}},F.addWidget("scrollObject",e)}(t);var a=setInterval(function(){var t=n.getTranslateArray(),r=parseInt(t[1]);r>0&&(n.stopMoveByCss(r),n.moveByCss("0.5",0),e=function(){o.pullDownCallback(),s.off("webkitTransitionEnd")},e(),clearInterval(a)),r<-n.maxMove&&(n.stopMoveByCss(r),n.moveByCss("0.5",-n.maxMove),e=function(){o.pullUpCallback(),s.off("webkitTransitionEnd")},e(),clearInterval(a))},100)}},F.addWidget("scrollObject",e)}(window);